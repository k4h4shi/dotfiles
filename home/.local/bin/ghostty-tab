#!/bin/bash
# Open a new Ghostty tab and run tmux attach in it.
# Usage: ghostty-tab <session_id>
#
# Note: Uses clipboard paste instead of keystroke to avoid keyboard layout issues
# (e.g., JIS vs US layout causing _ to become =)

SESSION_ID="$1"

if [[ -z "$SESSION_ID" ]]; then
    echo "Usage: ghostty-tab <session_id>" >&2
    exit 1
fi

# Save current clipboard, set command, paste, then restore
OLD_CLIPBOARD=$(pbpaste 2>/dev/null)
COMMAND="tmux attach -t $SESSION_ID"
echo -n "$COMMAND" | pbcopy

osascript <<EOF
tell application "Ghostty" to activate
delay 0.2
tell application "System Events"
    tell process "Ghostty"
        click menu item "New Tab" of menu "File" of menu bar item "File" of menu bar 1
    end tell
end tell
delay 0.2
tell application "System Events"
    keystroke "v" using command down
    keystroke return
end tell
EOF

# Restore original clipboard
echo -n "$OLD_CLIPBOARD" | pbcopy
