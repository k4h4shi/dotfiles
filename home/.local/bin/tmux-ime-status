#!/usr/bin/env bash
set -euo pipefail

if command -v im-select >/dev/null 2>&1; then
  source_id=$(im-select 2>/dev/null || true)
elif command -v macism >/dev/null 2>&1; then
  source_id=$(macism 2>/dev/null || true)
else
  printf '%s' 'IME:??'
  exit 0
fi
if [[ -z "$source_id" ]]; then
  printf '%s' 'IME:??'
  exit 0
fi

case "$source_id" in
  *Kotoeri*|*Japanese*|*Hiragana*|*Katakana*)
    # Tokyo Night: warning
    printf '%s' '#[fg=#d9b37b]IME:JP'
    ;;
  *)
    # Tokyo Night: success
    printf '%s' '#[fg=#9ece6a]IME:EN'
    ;;
esac
