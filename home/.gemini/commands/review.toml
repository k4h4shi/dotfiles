description = "Review code against project guidelines using worktree. Usage: /review [PR_NUMBER]"
prompt = """
# Code Review (Static Analysis)

Perform a static code review for a specific Pull Request using a dedicated worktree.
**DO NOT delete the worktree or modify code during this command execution.**

## 1. Worktree Setup

1.  **Get PR Info**:
    ```bash
    gh pr view <{args} or PR_NUMBER> --json headRefName,baseRefName
    ```
    - `headRefName`: The source branch
    - `baseRefName`: The target branch

2.  **Check Existing Worktree**:
    - Run `git worktree list` to check if a worktree for `headRefName` already exists.
    - **If it exists**: Use the existing worktree to continue the review.
    - **If it does not exist**: Proceed to create a new worktree.

3.  **Create Worktree (Only if needed)**:
    - Use `worktree-manager` agent.
    - **Branch**: Use the `headRefName` obtained above.
    - **Base**: Use the `baseRefName` (usually `origin/main`).
    - **Note**: Since this is for static review only, you can skip environment setup unless deep analysis is required (use `environment-setup` skill if needed).

4.  **Switch Context**:
    ```bash
    cd .worktrees/<branch-name>
    ```

## 2. Review Process

Analyze the code based on project guidelines.

- First read `AGENTS.md`, `docs/`, and `.cursor/rules/` (if present).
- If `.gemini/skills/` includes review guidance, follow it.

### Analysis Commands

```bash
# Get the list of changed files
git diff --name-only origin/main...HEAD
```

## 3. Reporting

**重要**: 必ず `gh pr review` を使用する。`gh pr comment` は絶対に使わない。

### 禁止事項

```bash
# NG: これは使わない
gh pr comment <PR_NUMBER> --body "..."
```

### 正しい投稿方法

1.  **レビュー内容をファイルに書き出す**:
    ```bash
    mkdir -p .tmp
    # write_file ツールで .tmp/review_body.md に内容を書き出す
    ```

2.  **`gh pr review` で投稿する**（判断基準に従って選択）:

    | 判断基準 | コマンド |
    |:---------|:---------|
    | 問題なし、マージ可能 | `gh pr review <PR_NUMBER> --approve --body-file .tmp/review_body.md` |
    | **修正が必要**（デフォルト） | `gh pr review <PR_NUMBER> --request-changes --body-file .tmp/review_body.md` |
    | 参考情報のみ（任意対応） | `gh pr review <PR_NUMBER> --comment --body-file .tmp/review_body.md` |

    ### 判断基準の詳細

    **`--request-changes` を使う場合（指摘があればこれがデフォルト）**:
    - バグ、ロジックの誤り
    - セキュリティ問題
    - 仕様・要件との不整合
    - テスト不足
    - 破壊的変更

    **`--comment` を使う場合（稀）**:
    - 純粋なコードスタイルの提案（機能に影響なし）
    - 将来の改善提案（今回のスコープ外）
    - 質問のみ

    **`--approve` を使う場合**:
    - 上記の問題が一切ない

**Write the review comments in JAPANESE.**
"""
